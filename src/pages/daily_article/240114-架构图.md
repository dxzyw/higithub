<img src="/assets/image/240114-æ¶æ„å›¾-1.png" style="max-width: 70%; height: auto;">
<small>32k starï¼Œæ¨èä¸€æ¬¾ç¥å™¨ï¼Œå·²å¼€æº</small>


å…ˆæ¥çœ‹ä¸‹æ•ˆæœå›¾ï¼Œå¦‚ä¸‹æ¶æ„å›¾æ˜¯ç”¨ä»£ç å®ç°çš„ï¼Œå¼€æºåœ°å€åœ¨æ–‡æœ«ï¼š
![](/assets/image/240114-æ¶æ„å›¾-1.png)

ä»‹ç»ä¸€ä¸‹ diagrams è¿™ä¸ªå·¥å…·ï¼Œå®ƒå¯ä»¥ç”¨ Python ä»£ç ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾

# diagramsï¼šç”¨ä»£ç ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾

## ä»€ä¹ˆæ˜¯ diagrams

diagrams æ˜¯ä¸€ä¸ªå¼€æºçš„ Python åº“ï¼Œå®ƒå¯ä»¥è®©ä½ ç”¨ Python ä»£ç æ¥ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š

- å¯ä»¥ç”¨ä»£ç æ¥æè¿°æˆ–å¯è§†åŒ–ç°æœ‰çš„æˆ–æ–°è®¾è®¡çš„ç³»ç»Ÿæ¶æ„
- å¯ä»¥è·Ÿè¸ªç³»ç»Ÿæ¶æ„å›¾çš„å˜åŒ–ï¼Œå› ä¸ºä»£ç å¯ä»¥ç”¨ä»»ä½•ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥ç®¡ç†
- æ”¯æŒä¸»æµçš„äº‘æœåŠ¡æä¾›å•†ï¼ŒåŒ…æ‹¬ AWS, Azure, GCP, Kubernetes, Alibaba Cloud, Oracle Cloud ç­‰
- ä¹Ÿæ”¯æŒæœ¬åœ°èŠ‚ç‚¹ï¼ŒSaaS å’Œä¸»è¦çš„ç¼–ç¨‹æ¡†æ¶å’Œè¯­è¨€
- ä¸éœ€è¦ä»»ä½•è®¾è®¡å·¥å…·ï¼Œåªéœ€è¦å®‰è£… Python å’Œ Graphviz
- ä¸ä¼šæ§åˆ¶ä»»ä½•å®é™…çš„äº‘èµ„æºï¼Œä¹Ÿä¸ä¼šç”Ÿæˆ cloud formation æˆ– terraform ä»£ç ï¼Œåªæ˜¯ç”¨äºç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾

## å¦‚ä½•ä½¿ç”¨ diagrams

è¦ä½¿ç”¨ diagramsï¼Œä½ éœ€è¦å…ˆå®‰è£… Python 3.7 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œç„¶åå®‰è£… diagrams åº“å’Œ Graphviz å·¥å…·ã€‚ä½ å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ï¼š

```bash
# ä½¿ç”¨ pip (pip3)
$ pip install diagrams

# ä½¿ç”¨ pipenv
$ pipenv install diagrams

# ä½¿ç”¨ poetry
$ poetry add diagrams
```

å®‰è£…å¥½ä¹‹åï¼Œä½ å°±å¯ä»¥ç”¨ Python ä»£ç æ¥ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾äº†ã€‚diagrams æä¾›äº†å„ç§äº‘æœåŠ¡çš„èŠ‚ç‚¹ï¼Œä½ å¯ä»¥ç”¨å®ƒä»¬æ¥ç»„åˆå‡ºä½ æƒ³è¦çš„å›¾å½¢ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç å¯ä»¥ç»˜åˆ¶ä¸€ä¸ªç®€å•çš„ ä¸šåŠ¡æ¶æ„å›¾ï¼š

```python
from diagrams import Cluster, Diagram
from diagrams.alibabacloud.network import SLB
from diagrams.alibabacloud.compute import ECS
from diagrams.alibabacloud.web import Domain    
from diagrams.alibabacloud.web import Dns
from diagrams.onprem.network import Nginx
from diagrams.onprem.compute import Server
from diagrams.alibabacloud.database import RDS
from diagrams.elastic.elasticsearch import  Beats
from diagrams.elastic.elasticsearch import  Elasticsearch
from diagrams.elastic.elasticsearch import  Kibana
from diagrams.elastic.elasticsearch import  Logstash
from diagrams.onprem.compute import Server
from diagrams.onprem.database import PostgreSQL
from diagrams.onprem.inmemory import Redis
from diagrams.onprem.monitoring import Grafana, Prometheus,PrometheusOperator
from diagrams.onprem.network import Nginx
from diagrams.onprem.queue import Kafka


with Diagram("Advanced Web Service with On-Premise", show=False):
    domain = Domain("domain")
    dns = Dns("dns")
    ingress = Nginx("nginx")


    metrics = PrometheusOperator("metric")
    metrics << Prometheus("prometheus") << Grafana("monitoring")


    with Cluster("Service Cluster"):
        grpcsvc = [
            Server("web1"),
            Server("web2"),
            Server("web3")]


    with Cluster("Sessions HA"):
        primary = Redis("session")
        primary - Redis("replica") << metrics
        grpcsvc >> primary


    with Cluster("Database HA"):
        primary = PostgreSQL("users")
        primary - PostgreSQL("replica") << metrics
        grpcsvc >> primary


    aggregator = Beats("logging")
    aggregator >> Kafka("stream") >> Logstash("analytics") >> Elasticsearch("es") >> Kibana("kibana")


    domain >> dns >> ingress >> grpcsvc >> aggregator
```

è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ å°±å¯ä»¥å¾—åˆ°ä¸‹é¢çš„å›¾å½¢ï¼š

![](/assets/image/240114-æ¶æ„å›¾-2.png)



## å¦‚ä½•å®‰è£… diagrams

è¦å®‰è£… diagramsï¼Œä½ éœ€è¦å…ˆå®‰è£… Python 3.7 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œç„¶åå®‰è£… diagrams åº“å’Œ Graphviz å·¥å…·ã€‚ä½ å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…ï¼š

```bash
# ä½¿ç”¨ pip (pip3)
$ pip install diagrams

# ä½¿ç”¨ pipenv
$ pipenv install diagrams

# ä½¿ç”¨ poetry
$ poetry add diagrams
```

å¦‚æœä½ æ˜¯ macOS ç”¨æˆ·ï¼Œä½ å¯ä»¥ç”¨ Homebrew æ¥å®‰è£… Graphvizï¼š

```bash
$ brew install graphviz
```

## ç±»ä¼¼çš„å·¥å…·

é™¤äº† diagramsï¼Œè¿˜æœ‰ä¸€äº›ç±»ä¼¼çš„å·¥å…·ï¼Œå¯ä»¥ç”¨ä»£ç æ¥ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾ï¼Œä¾‹å¦‚ï¼š

- [D2](^5^)ï¼šä¸€ä¸ªç”¨ Go è¯­è¨€ç¼–å†™çš„åº“ï¼Œå¯ä»¥ç”¨ DSLï¼ˆé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰æ¥ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾
- [Mermaid](^6^)ï¼šä¸€ä¸ªç”¨ JavaScript ç¼–å†™çš„åº“ï¼Œå¯ä»¥ç”¨ Markdown é£æ ¼çš„è¯­æ³•æ¥ç»˜åˆ¶æµç¨‹å›¾ï¼Œåºåˆ—å›¾ï¼Œç”˜ç‰¹å›¾ç­‰
- [Excalidraw]ï¼šä¸€ä¸ªç”¨ React ç¼–å†™çš„åº“ï¼Œå¯ä»¥ç”¨æ‰‹ç»˜é£æ ¼çš„å›¾å½¢æ¥ç»˜åˆ¶å„ç§å›¾è¡¨
- [Structurizr/Java]ï¼šä¸€ä¸ªç”¨ Java ç¼–å†™çš„åº“ï¼Œå¯ä»¥ç”¨ä»£ç æ¥åˆ›å»ºè½¯ä»¶æ¶æ„æ¨¡å‹å’Œå›¾å½¢
- [Modules.tf-lambda]ï¼šä¸€ä¸ªç”¨ Terraform ç¼–å†™çš„æ¨¡å—ï¼Œå¯ä»¥ç”¨ä»£ç æ¥ç”Ÿæˆ AWS Lambda æ¶æ„å›¾
- [C4-draw.io]ï¼šä¸€ä¸ªç”¨ draw.io ç¼–å†™çš„æ’ä»¶ï¼Œå¯ä»¥ç”¨ C4 æ¨¡å‹æ¥ç»˜åˆ¶è½¯ä»¶æ¶æ„å›¾

## æ€»ç»“

diagrams æ˜¯ä¸€ä¸ªç”¨ Python ä»£ç æ¥ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾çš„å·¥å…·ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š

- å¯ä»¥ç”¨ä»£ç æ¥æè¿°æˆ–å¯è§†åŒ–ç°æœ‰çš„æˆ–æ–°è®¾è®¡çš„ç³»ç»Ÿæ¶æ„
- å¯ä»¥è·Ÿè¸ªç³»ç»Ÿæ¶æ„å›¾çš„å˜åŒ–ï¼Œå› ä¸ºä»£ç å¯ä»¥ç”¨ä»»ä½•ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿæ¥ç®¡ç†
- æ”¯æŒä¸»æµçš„äº‘æœåŠ¡æä¾›å•†ï¼ŒåŒ…æ‹¬ AWS, Azure, GCP, Kubernetes, Alibaba Cloud, Oracle Cloud ç­‰
- ä¹Ÿæ”¯æŒæœ¬åœ°èŠ‚ç‚¹ï¼ŒSaaS å’Œä¸»è¦çš„ç¼–ç¨‹æ¡†æ¶å’Œè¯­è¨€
- ä¸éœ€è¦ä»»ä½•è®¾è®¡å·¥å…·ï¼Œåªéœ€è¦å®‰è£… Python å’Œ Graphviz
- ä¸ä¼šæ§åˆ¶ä»»ä½•å®é™…çš„äº‘èµ„æºï¼Œä¹Ÿä¸ä¼šç”Ÿæˆ cloud formation æˆ– terraform ä»£ç ï¼Œåªæ˜¯ç”¨äºç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾

å¦‚æœä½ æƒ³ç”¨ä»£ç æ¥ç»˜åˆ¶äº‘ç³»ç»Ÿæ¶æ„å›¾ï¼Œdiagrams æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ä½ å¯ä»¥åœ¨ [æ–‡æœ«](^2^) æ‰¾åˆ° diagrams çš„æºç å’Œæ–‡æ¡£ã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹å…¶ä»–ç±»ä¼¼çš„å·¥å…·ï¼Œçœ‹çœ‹å“ªä¸ªæ›´é€‚åˆä½ çš„éœ€æ±‚ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè°¢è°¢ä½ çš„é˜…è¯»ã€‚ğŸ™



å¼€æºåœ°å€ï¼šhttps://github.com/mingrammer/diagrams
å®˜ç½‘åœ°å€ï¼šhttps://diagrams.mingrammer.com/