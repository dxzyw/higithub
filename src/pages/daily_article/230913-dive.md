<img src="/assets/image/230913-dive-1.gif" style="max-width: 70%; height: auto;">
<small>41.5k star，推荐一款开源神器，很强！</small>


dive是一个用于探索和优化Docker镜像层次结构的工具，它可以显示每一层的文件和目录，以及它们的大小、状态和效率，还可以给出一些缩小镜像大小的建议。

![](/assets/image/230913-dive-1.gif)


# 用dive探索Docker镜像的层次结构

Docker是一种流行的容器技术，它可以让开发者和运维人员轻松地打包、部署和运行应用程序。

Docker镜像是一种用于创建容器的文件，它包含了应用程序的代码、依赖和配置。

Docker镜像是由多个层次组成的，每一层都是一个只读的文件系统，它们按照一定的顺序叠加在一起，形成一个完整的镜像。

为了优化Docker镜像的大小和性能，我们需要了解每一层的内容和作用，以及如何减少无用的文件和数据。

这就是dive这个工具的用途。dive是一个用于探索Docker镜像层次结构的工具，它可以显示每一层的文件和目录，以及它们与上一层的差异。

dive还可以计算每一层的效率，即有效文件占总文件的比例，以及给出一些优化建议。dive的目标是帮助用户发现如何缩小Docker镜像的大小。
![](/assets/image/230913-dive-2.png)


## dive的安装和使用

dive支持多种操作系统和平台，包括Linux、MacOS、Windows和ARM。dive还可以作为一个Docker镜像来运行，这样就不需要在本地安装dive了。

dive的安装和使用方法可以在它的README文件中找到。

要使用dive分析一个Docker镜像，只需要运行以下命令：

```bash
dive <your-image-tag>
```

或者，你也可以直接使用docker命令来运行dive，只需要设置一个别名：

```bash
alias dive="docker run -ti --rm -v /var/run/docker.sock:/var/run/docker.sock wagoodman/dive"
dive <your-image-tag>
```

dive还可以在构建镜像的过程中进行分析，只需要运行以下命令：

```bash
dive build -t <some-tag> .
```

如果你想在CI（持续集成）环境中使用dive，你可以设置一个环境变量`CI=true`，这样就可以跳过交互式的界面，只输出分析结果：

```bash
CI=true dive <your-image>
```

![](/assets/image/230913-dive-3.png)

## dive的界面和功能

当你运行dive命令后，你会看到一个类似于这样的界面：


![](/assets/image/230913-dive-4.gif)


这个界面可以分为四个部分：

- 左上角是镜像的层次列表，每一层都有一个ID、一个命令、一个大小和一个效率。你可以用上下方向键来选择不同的层。
- 右上角是镜像的详细信息，包括镜像的名称、标签、ID、大小、创建时间和命令等。
- 左下角是当前层的文件和目录列表，你可以用左右方向键来展开或收起目录，用回车键来切换排序方式，用空格键来标记文件或目录。
- 右下角是当前层和上一层的文件差异，用不同的颜色来表示文件的状态，比如添加、修改或删除等。

![](/assets/image/230913-dive-5.png)

## dive的优点和局限

dive有以下几个优点：

- 界面简洁美观，操作方便快捷，支持多种交互方式和显示方式
- 分析结果详细准确，可以显示每一层的文件和目录，以及它们的大小、状态和效率
- 优化建议实用有效，可以帮助用户发现无用的文件和数据，以及如何删除或合并它们
- 兼容性强，支持多种操作系统和平台，以及多种容器引擎，如Docker、Podman和Kaniko等

![grafana的分层情况](/assets/image/230913-dive-6.png)


当然，dive也有一些局限，比如：

- 不能直接修改或删除镜像的文件或层，只能提供一些建议，用户还需要自己去实施
- 不能分析远程的镜像，只能分析本地的镜像，用户需要先拉取镜像到本地才能使用dive
- 不能分析非Docker格式的镜像，比如OCI或ACI等，用户需要先转换镜像的格式才能使用dive

## 总结

dive是一个用于探索Docker镜像层次结构的工具，它可以帮助用户了解每一层的内容和作用，以及如何缩小镜像的大小。




